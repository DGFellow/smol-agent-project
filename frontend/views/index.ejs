<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title><%= title %></title>
  <link rel="stylesheet" href="/css/style.css"/>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
</head>
<body class="theme-dark" data-mode="hero">
  <div id="app-shell" class="app-shell">

    <!-- Sidebar -->
    <%- include('sidebar', { 
      user: typeof user !== 'undefined' ? user : null,
      conversations: typeof conversations !== 'undefined' ? conversations : []
    }) %>

    <!-- Right column -->
    <div class="app-content">
      <%- include('header') %>

      <div id="main-wrapper" class="main-wrapper">
        <main class="chat-container">

          <!-- Empty-state hero (centered) -->
          <section id="empty-hero" class="empty-hero" aria-hidden="false">
            <h2 class="hero-title">
              <% if (user && user.username) { %>
                <span class="hero-spark">âœ±</span> Hi <%= user.username.split(' ')[0] %>, how are you?
              <% } else { %>
                What can I help with?
              <% } %>
            </h2>

            <!-- Single pill-composer (starts in hero, moves to bottom later) -->
            <div id="unified-composer" class="pill-composer">
              <div class="pill-left">
                <button class="pill-icon-btn" title="Add">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </button>
                <button class="pill-icon-btn" title="Settings">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
                    <path d="M12 2v4m0 12v4M2 12h4m12 0h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </button>
                <button class="pill-icon-btn" title="Timer">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="13" r="8" stroke="currentColor" stroke-width="2"/>
                    <path d="M9 3h6M12 9v5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </button>
              </div>

              <textarea id="hero-input" class="pill-input" placeholder="How can I help you today?" rows="1"></textarea>

              <div class="pill-right">
                <button class="pill-icon-btn" id="pill-voice" title="Voice (coming soon)">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <rect x="9" y="3" width="6" height="12" rx="3" stroke="currentColor" stroke-width="2"/>
                    <path d="M5 12a7 7 0 0014 0M12 19v2" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                </button>
                <button class="pill-send" id="hero-send" title="Send">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none">
                    <path d="M4 12l16-8-5.5 8L20 20l-16-8z" stroke="currentColor" stroke-width="1.6" stroke-linejoin="round"/>
                  </svg>
                </button>
              </div>
            </div>

            <!-- Chips row -->
            <div class="hero-chips">
              <button class="chip" data-chip="code">âŒ¥ Code</button>
              <button class="chip" data-chip="write">âœŽ Write</button>
              <button class="chip" data-chip="strategy">â†— Strategize</button>
              <button class="chip" data-chip="learn">ðŸŽ“ Learn</button>
              <button class="chip" data-chip="life">â˜• Life stuff</button>
            </div>
          </section>

          <!-- Chat Interface (hidden until first message) -->
          <div class="chat-interface" id="chat-ui" hidden>
            <div id="chat-messages" class="messages"></div>

            <!-- Bottom input area: we will MOVE #unified-composer here after first send -->
            <div class="input-area" id="input-area">
              <!-- intentionally empty on load -->
              <!-- unified-composer will be appended here by JS -->
              <div id="input-bottom-anchor"></div>
            </div>
          </div>

        </main>
      </div>

      <%- include('footer') %>
    </div>
  </div>

  <script src="/js/main.js"></script>
</body>
</html>
